var cov_1x83at73ow=function(){var path='/Users/e0c009o/workspace/gateway-api/server.js',hash='2d26133cfa4847423f8b1267b27b9d73d4435083',global=new Function('return this')(),gcv='__coverage__',coverageData={path:'/Users/e0c009o/workspace/gateway-api/server.js',statementMap:{'0':{start:{line:1,column:14},end:{line:1,column:32}},'1':{start:{line:2,column:10},end:{line:2,column:19}},'2':{start:{line:3,column:15},end:{line:3,column:31}},'3':{start:{line:4,column:9},end:{line:4,column:33}},'4':{start:{line:5,column:17},end:{line:5,column:39}},'5':{start:{line:6,column:14},end:{line:6,column:32}},'6':{start:{line:7,column:11},end:{line:7,column:26}},'7':{start:{line:8,column:16},end:{line:8,column:42}},'8':{start:{line:9,column:20},end:{line:9,column:44}},'9':{start:{line:10,column:15},end:{line:10,column:39}},'10':{start:{line:11,column:9},end:{line:11,column:22}},'11':{start:{line:12,column:11},end:{line:12,column:16}},'12':{start:{line:14,column:0},end:{line:14,column:47}},'13':{start:{line:16,column:0},end:{line:16,column:51}},'14':{start:{line:21,column:0},end:{line:23,column:3}},'15':{start:{line:22,column:2},end:{line:22,column:51}},'16':{start:{line:25,column:0},end:{line:27,column:3}},'17':{start:{line:26,column:2},end:{line:26,column:53}},'18':{start:{line:28,column:0},end:{line:30,column:3}},'19':{start:{line:29,column:2},end:{line:29,column:49}},'20':{start:{line:32,column:0},end:{line:36,column:3}},'21':{start:{line:34,column:2},end:{line:34,column:31}},'22':{start:{line:37,column:0},end:{line:40,column:3}},'23':{start:{line:39,column:2},end:{line:39,column:51}},'24':{start:{line:41,column:0},end:{line:106,column:3}},'25':{start:{line:42,column:2},end:{line:42,column:53}},'26':{start:{line:45,column:2},end:{line:48,column:5}},'27':{start:{line:50,column:2},end:{line:56,column:5}},'28':{start:{line:51,column:4},end:{line:55,column:5}},'29':{start:{line:52,column:6},end:{line:52,column:53}},'30':{start:{line:54,column:6},end:{line:54,column:46}},'31':{start:{line:58,column:15},end:{line:58,column:36}},'32':{start:{line:59,column:2},end:{line:103,column:3}},'33':{start:{line:60,column:19},end:{line:60,column:142}},'34':{start:{line:61,column:4},end:{line:68,column:7}},'35':{start:{line:62,column:6},end:{line:64,column:7}},'36':{start:{line:63,column:8},end:{line:63,column:21}},'37':{start:{line:65,column:6},end:{line:67,column:7}},'38':{start:{line:66,column:8},end:{line:66,column:29}},'39':{start:{line:69,column:9},end:{line:103,column:3}},'40':{start:{line:70,column:19},end:{line:70,column:131}},'41':{start:{line:71,column:4},end:{line:79,column:7}},'42':{start:{line:72,column:6},end:{line:75,column:7}},'43':{start:{line:74,column:8},end:{line:74,column:21}},'44':{start:{line:76,column:6},end:{line:78,column:7}},'45':{start:{line:77,column:8},end:{line:77,column:29}},'46':{start:{line:80,column:9},end:{line:103,column:3}},'47':{start:{line:81,column:19},end:{line:81,column:132}},'48':{start:{line:82,column:4},end:{line:90,column:7}},'49':{start:{line:83,column:6},end:{line:86,column:7}},'50':{start:{line:85,column:8},end:{line:85,column:21}},'51':{start:{line:87,column:6},end:{line:89,column:7}},'52':{start:{line:88,column:8},end:{line:88,column:29}},'53':{start:{line:92,column:4},end:{line:92,column:53}},'54':{start:{line:93,column:19},end:{line:93,column:142}},'55':{start:{line:94,column:4},end:{line:102,column:7}},'56':{start:{line:95,column:6},end:{line:98,column:7}},'57':{start:{line:97,column:8},end:{line:97,column:21}},'58':{start:{line:99,column:6},end:{line:101,column:7}},'59':{start:{line:100,column:8},end:{line:100,column:29}},'60':{start:{line:110,column:13},end:{line:110,column:23}},'61':{start:{line:112,column:2},end:{line:137,column:5}},'62':{start:{line:136,column:4},end:{line:136,column:21}},'63':{start:{line:141,column:2},end:{line:141,column:30}},'64':{start:{line:142,column:2},end:{line:142,column:17}},'65':{start:{line:148,column:2},end:{line:162,column:7}},'66':{start:{line:153,column:6},end:{line:156,column:7}},'67':{start:{line:154,column:23},end:{line:154,column:39}},'68':{start:{line:155,column:8},end:{line:155,column:33}},'69':{start:{line:161,column:6},end:{line:161,column:26}},'70':{start:{line:165,column:0},end:{line:165,column:21}}},fnMap:{'0':{name:'(anonymous_0)',decl:{start:{line:21,column:41},end:{line:21,column:42}},loc:{start:{line:21,column:61},end:{line:23,column:1}},line:21},'1':{name:'(anonymous_1)',decl:{start:{line:25,column:38},end:{line:25,column:39}},loc:{start:{line:25,column:58},end:{line:27,column:1}},line:25},'2':{name:'(anonymous_2)',decl:{start:{line:28,column:35},end:{line:28,column:36}},loc:{start:{line:28,column:55},end:{line:30,column:1}},line:28},'3':{name:'(anonymous_3)',decl:{start:{line:32,column:27},end:{line:32,column:28}},loc:{start:{line:32,column:47},end:{line:36,column:1}},line:32},'4':{name:'(anonymous_4)',decl:{start:{line:37,column:36},end:{line:37,column:37}},loc:{start:{line:37,column:62},end:{line:40,column:1}},line:37},'5':{name:'(anonymous_5)',decl:{start:{line:41,column:17},end:{line:41,column:18}},loc:{start:{line:41,column:29},end:{line:106,column:1}},line:41},'6':{name:'(anonymous_6)',decl:{start:{line:50,column:40},end:{line:50,column:41}},loc:{start:{line:50,column:57},end:{line:56,column:3}},line:50},'7':{name:'(anonymous_7)',decl:{start:{line:61,column:28},end:{line:61,column:29}},loc:{start:{line:61,column:55},end:{line:68,column:5}},line:61},'8':{name:'(anonymous_8)',decl:{start:{line:71,column:40},end:{line:71,column:41}},loc:{start:{line:71,column:67},end:{line:79,column:5}},line:71},'9':{name:'(anonymous_9)',decl:{start:{line:82,column:40},end:{line:82,column:41}},loc:{start:{line:82,column:67},end:{line:90,column:5}},line:82},'10':{name:'(anonymous_10)',decl:{start:{line:94,column:40},end:{line:94,column:41}},loc:{start:{line:94,column:67},end:{line:102,column:5}},line:94},'11':{name:'inES',decl:{start:{line:108,column:9},end:{line:108,column:13}},loc:{start:{line:108,column:22},end:{line:138,column:1}},line:108},'12':{name:'(anonymous_12)',decl:{start:{line:135,column:10},end:{line:135,column:11}},loc:{start:{line:135,column:22},end:{line:137,column:3}},line:135},'13':{name:'shutDownServer',decl:{start:{line:140,column:9},end:{line:140,column:23}},loc:{start:{line:140,column:26},end:{line:143,column:1}},line:140},'14':{name:'callCcmConfig',decl:{start:{line:145,column:9},end:{line:145,column:22}},loc:{start:{line:145,column:43},end:{line:163,column:1}},line:145},'15':{name:'(anonymous_15)',decl:{start:{line:152,column:4},end:{line:152,column:5}},loc:{start:{line:152,column:37},end:{line:159,column:5}},line:152},'16':{name:'(anonymous_16)',decl:{start:{line:159,column:19},end:{line:159,column:20}},loc:{start:{line:159,column:34},end:{line:162,column:5}},line:159}},branchMap:{'0':{loc:{start:{line:51,column:4},end:{line:55,column:5}},type:'if',locations:[{start:{line:51,column:4},end:{line:55,column:5}},{start:{line:51,column:4},end:{line:55,column:5}}],line:51},'1':{loc:{start:{line:59,column:2},end:{line:103,column:3}},type:'if',locations:[{start:{line:59,column:2},end:{line:103,column:3}},{start:{line:59,column:2},end:{line:103,column:3}}],line:59},'2':{loc:{start:{line:59,column:6},end:{line:59,column:48}},type:'binary-expr',locations:[{start:{line:59,column:6},end:{line:59,column:25}},{start:{line:59,column:29},end:{line:59,column:48}}],line:59},'3':{loc:{start:{line:62,column:6},end:{line:64,column:7}},type:'if',locations:[{start:{line:62,column:6},end:{line:64,column:7}},{start:{line:62,column:6},end:{line:64,column:7}}],line:62},'4':{loc:{start:{line:65,column:6},end:{line:67,column:7}},type:'if',locations:[{start:{line:65,column:6},end:{line:67,column:7}},{start:{line:65,column:6},end:{line:67,column:7}}],line:65},'5':{loc:{start:{line:69,column:9},end:{line:103,column:3}},type:'if',locations:[{start:{line:69,column:9},end:{line:103,column:3}},{start:{line:69,column:9},end:{line:103,column:3}}],line:69},'6':{loc:{start:{line:69,column:13},end:{line:69,column:55}},type:'binary-expr',locations:[{start:{line:69,column:13},end:{line:69,column:32}},{start:{line:69,column:36},end:{line:69,column:55}}],line:69},'7':{loc:{start:{line:72,column:6},end:{line:75,column:7}},type:'if',locations:[{start:{line:72,column:6},end:{line:75,column:7}},{start:{line:72,column:6},end:{line:75,column:7}}],line:72},'8':{loc:{start:{line:76,column:6},end:{line:78,column:7}},type:'if',locations:[{start:{line:76,column:6},end:{line:78,column:7}},{start:{line:76,column:6},end:{line:78,column:7}}],line:76},'9':{loc:{start:{line:80,column:9},end:{line:103,column:3}},type:'if',locations:[{start:{line:80,column:9},end:{line:103,column:3}},{start:{line:80,column:9},end:{line:103,column:3}}],line:80},'10':{loc:{start:{line:80,column:13},end:{line:80,column:57}},type:'binary-expr',locations:[{start:{line:80,column:13},end:{line:80,column:33}},{start:{line:80,column:37},end:{line:80,column:57}}],line:80},'11':{loc:{start:{line:83,column:6},end:{line:86,column:7}},type:'if',locations:[{start:{line:83,column:6},end:{line:86,column:7}},{start:{line:83,column:6},end:{line:86,column:7}}],line:83},'12':{loc:{start:{line:87,column:6},end:{line:89,column:7}},type:'if',locations:[{start:{line:87,column:6},end:{line:89,column:7}},{start:{line:87,column:6},end:{line:89,column:7}}],line:87},'13':{loc:{start:{line:95,column:6},end:{line:98,column:7}},type:'if',locations:[{start:{line:95,column:6},end:{line:98,column:7}},{start:{line:95,column:6},end:{line:98,column:7}}],line:95},'14':{loc:{start:{line:99,column:6},end:{line:101,column:7}},type:'if',locations:[{start:{line:99,column:6},end:{line:101,column:7}},{start:{line:99,column:6},end:{line:101,column:7}}],line:99},'15':{loc:{start:{line:153,column:6},end:{line:156,column:7}},type:'if',locations:[{start:{line:153,column:6},end:{line:156,column:7}},{start:{line:153,column:6},end:{line:156,column:7}}],line:153}},s:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0,'17':0,'18':0,'19':0,'20':0,'21':0,'22':0,'23':0,'24':0,'25':0,'26':0,'27':0,'28':0,'29':0,'30':0,'31':0,'32':0,'33':0,'34':0,'35':0,'36':0,'37':0,'38':0,'39':0,'40':0,'41':0,'42':0,'43':0,'44':0,'45':0,'46':0,'47':0,'48':0,'49':0,'50':0,'51':0,'52':0,'53':0,'54':0,'55':0,'56':0,'57':0,'58':0,'59':0,'60':0,'61':0,'62':0,'63':0,'64':0,'65':0,'66':0,'67':0,'68':0,'69':0,'70':0},f:{'0':0,'1':0,'2':0,'3':0,'4':0,'5':0,'6':0,'7':0,'8':0,'9':0,'10':0,'11':0,'12':0,'13':0,'14':0,'15':0,'16':0},b:{'0':[0,0],'1':[0,0],'2':[0,0],'3':[0,0],'4':[0,0],'5':[0,0],'6':[0,0],'7':[0,0],'8':[0,0],'9':[0,0],'10':[0,0],'11':[0,0],'12':[0,0],'13':[0,0],'14':[0,0],'15':[0,0]},_coverageSchema:'332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'},coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}coverageData.hash=hash;return coverage[path]=coverageData;}();var express=(cov_1x83at73ow.s[0]++,require('express'));var app=(cov_1x83at73ow.s[1]++,express());var basePath=(cov_1x83at73ow.s[2]++,express.Router());var ws=(cov_1x83at73ow.s[3]++,require('./services.js'));var bodyParser=(cov_1x83at73ow.s[4]++,require('body-parser'));var request=(cov_1x83at73ow.s[5]++,require("request"));var path=(cov_1x83at73ow.s[6]++,require('path'));var errorCode=(cov_1x83at73ow.s[7]++,require('./errorCodes.js'));var elasticsearch=(cov_1x83at73ow.s[8]++,require('elasticsearch'));var services=(cov_1x83at73ow.s[9]++,require('./services.js'));var fs=(cov_1x83at73ow.s[10]++,require('fs'));var flag=(cov_1x83at73ow.s[11]++,false);cov_1x83at73ow.s[12]++;app.use('/wfm/reporting/gateway/v1',basePath);cov_1x83at73ow.s[13]++;app.use(bodyParser.urlencoded({extended:true}));var constants;var client;cov_1x83at73ow.s[14]++;basePath.post('/files/:fileName/upload',function(req,res){cov_1x83at73ow.f[0]++;cov_1x83at73ow.s[15]++;services.uploadFile(req,res,constants,client);});cov_1x83at73ow.s[16]++;basePath.get('/files/:file/download',function(req,res){cov_1x83at73ow.f[1]++;cov_1x83at73ow.s[17]++;services.downloadFile(req,res,constants,client);});cov_1x83at73ow.s[18]++;basePath.head('/files/:file/move',function(req,res){cov_1x83at73ow.f[2]++;cov_1x83at73ow.s[19]++;services.moveFile(req,res,constants,client);});cov_1x83at73ow.s[20]++;basePath.get('/heartbeat',function(req,res){cov_1x83at73ow.f[3]++;cov_1x83at73ow.s[21]++;services.heartbeat(req,res);});cov_1x83at73ow.s[22]++;basePath.post('/files/:file/parse',function(req,res,next){cov_1x83at73ow.f[4]++;cov_1x83at73ow.s[23]++;services.findParser(req,res,constants,client);});cov_1x83at73ow.s[24]++;app.listen(3000,function(){cov_1x83at73ow.f[5]++;cov_1x83at73ow.s[25]++;console.log('Example app listening on port 3000!');//////////////////////////////// ELASTIC SEARCH CONNECTION //////////////////////////////////////////////
cov_1x83at73ow.s[26]++;client=new elasticsearch.Client({host:'http://elastic.stg1.alert.bopwm.qa.cloud.wal-mart.com/',log:'trace'});cov_1x83at73ow.s[27]++;client.ping({requestTimeout:1000},function(error){cov_1x83at73ow.f[6]++;cov_1x83at73ow.s[28]++;if(error){cov_1x83at73ow.b[0][0]++;cov_1x83at73ow.s[29]++;console.trace('Elasticsearch cluster is down');}else{cov_1x83at73ow.b[0][1]++;cov_1x83at73ow.s[30]++;console.log('Elasticsearch is working');}});//////////////////////////////////////////////////////////////////////////////////////////////////////////
var myArgs=(cov_1x83at73ow.s[31]++,process.argv.slice(2));cov_1x83at73ow.s[32]++;if((cov_1x83at73ow.b[2][0]++,myArgs[0]==='dev')||(cov_1x83at73ow.b[2][1]++,myArgs[0]==='DEV')){cov_1x83at73ow.b[1][0]++;var filePath=(cov_1x83at73ow.s[33]++,'http://wfm-ccm.dev.platform-services.bopwm.dev.cloud.wal-mart.com:3000/wfm/common/v1/myConfig?id=595115d1852ba0f2ed1619f6');cov_1x83at73ow.s[34]++;callCcmConfig(filePath,function(response,error){cov_1x83at73ow.f[7]++;cov_1x83at73ow.s[35]++;if(error){cov_1x83at73ow.b[3][0]++;cov_1x83at73ow.s[36]++;inES(client);}else{cov_1x83at73ow.b[3][1]++;}cov_1x83at73ow.s[37]++;if(response){cov_1x83at73ow.b[4][0]++;cov_1x83at73ow.s[38]++;constants=response;}else{cov_1x83at73ow.b[4][1]++;}});}else{cov_1x83at73ow.b[1][1]++;cov_1x83at73ow.s[39]++;if((cov_1x83at73ow.b[6][0]++,myArgs[0]==='stg')||(cov_1x83at73ow.b[6][1]++,myArgs[0]==='STG')){cov_1x83at73ow.b[5][0]++;var filePath=(cov_1x83at73ow.s[40]++,'http://wfm-ccm.stg.platform-services.bopwm.prod.walmart.com/wfm/common/v1/myConfig?id=5963f0714973c2170c29a494');cov_1x83at73ow.s[41]++;constants=callCcmConfig(filePath,function(response,error){cov_1x83at73ow.f[8]++;cov_1x83at73ow.s[42]++;if(error){cov_1x83at73ow.b[7][0]++;cov_1x83at73ow.s[43]++;//send error message to elastic search
inES(client);}else{cov_1x83at73ow.b[7][1]++;}cov_1x83at73ow.s[44]++;if(response){cov_1x83at73ow.b[8][0]++;cov_1x83at73ow.s[45]++;constants=response;}else{cov_1x83at73ow.b[8][1]++;}});}else{cov_1x83at73ow.b[5][1]++;cov_1x83at73ow.s[46]++;if((cov_1x83at73ow.b[10][0]++,myArgs[0]==='prod')||(cov_1x83at73ow.b[10][1]++,myArgs[0]==='PROD')){cov_1x83at73ow.b[9][0]++;var filePath=(cov_1x83at73ow.s[47]++,'http://wfm-ccm.prod.platform-services.bopwm.prod.walmart.com/wfm/common/v1/myConfig?id=5963f09c8598e20d058cee8a');cov_1x83at73ow.s[48]++;constants=callCcmConfig(filePath,function(response,error){cov_1x83at73ow.f[9]++;cov_1x83at73ow.s[49]++;if(error){cov_1x83at73ow.b[11][0]++;cov_1x83at73ow.s[50]++;//send error message to elastic search
inES(client);}else{cov_1x83at73ow.b[11][1]++;}cov_1x83at73ow.s[51]++;if(response){cov_1x83at73ow.b[12][0]++;cov_1x83at73ow.s[52]++;constants=response;}else{cov_1x83at73ow.b[12][1]++;}});}else{cov_1x83at73ow.b[9][1]++;cov_1x83at73ow.s[53]++;console.trace('No env arg passed in, using Dev');var filePath=(cov_1x83at73ow.s[54]++,'http://wfm-ccm.dev.platform-services.bopwm.dev.cloud.wal-mart.com:3000/wfm/common/v1/myConfig?id=595115d1852ba0f2ed1619f6');cov_1x83at73ow.s[55]++;constants=callCcmConfig(filePath,function(response,error){cov_1x83at73ow.f[10]++;cov_1x83at73ow.s[56]++;if(error){cov_1x83at73ow.b[13][0]++;cov_1x83at73ow.s[57]++;//send error message to elastic search
inES(client);}else{cov_1x83at73ow.b[13][1]++;}cov_1x83at73ow.s[58]++;if(response){cov_1x83at73ow.b[14][0]++;cov_1x83at73ow.s[59]++;constants=response;}else{cov_1x83at73ow.b[14][1]++;}});}}}});function inES(client){cov_1x83at73ow.f[11]++;var date=(cov_1x83at73ow.s[60]++,new Date());cov_1x83at73ow.s[61]++;client.index({index:'events',type:'event',body:new errorCode.elasticSearch('ReportingGatewayAPI','API','ERROR','HIGH','',date,'on startup','500','1','WFM-CCM IS DOWN','WFM-CCM IS DOWN, SO GATEWAY API SHUT DOWN ALSO','SSH INTO THE BOX AND RESTART REPORTING GATEWAY API','WFM-CCM IS DOWN','HIGH','WFM-CCM IS DOWN, SO GATEWAY API SHUT DOWN ALSO','https://walmarttech.slack.com/messages/gwfm-support/','gwfm-support','WFM-CCM IS DOWN, SO GATEWAY API SHUT DOWN ALSO')}).then(function(){cov_1x83at73ow.f[12]++;cov_1x83at73ow.s[62]++;shutDownServer();});}function shutDownServer(){cov_1x83at73ow.f[13]++;cov_1x83at73ow.s[63]++;console.log('CCM is Down!');cov_1x83at73ow.s[64]++;process.exit();}function callCcmConfig(filePath,callback){cov_1x83at73ow.f[14]++;cov_1x83at73ow.s[65]++;request({method:'GET',uri:filePath},function(error,response,body){cov_1x83at73ow.f[15]++;cov_1x83at73ow.s[66]++;if(response){cov_1x83at73ow.b[15][0]++;var jsonBody=(cov_1x83at73ow.s[67]++,JSON.parse(body));cov_1x83at73ow.s[68]++;callback(jsonBody,null);}else{cov_1x83at73ow.b[15][1]++;}}).on('error',function(err){cov_1x83at73ow.f[16]++;cov_1x83at73ow.s[69]++;callback(null,err);});}cov_1x83at73ow.s[70]++;module.exports=app;